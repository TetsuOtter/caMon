# caMon本体開発に参加する

## 環境構築
caMon本体をビルドするには, .Net Core WPF Appがビルドできる環境が必要です.  この点に関してはご自身でお調べ頂ければと思います.  
以下, .Net Core WPF Applicationを開発できる状態のVisual Studio 2019 Community Editionを例に示します.

基本的にリポジトリをローカルにcloneし, slnファイルを開き, 「NuGetパッケージの復元」を行えば, ビルドが可能になるかと思います.  nuget.orgより依存ライブラリをダウンロードしてくるのにネットワーク接続が必要になりますので, ご注意ください.

## パッケージングについて
「ビルド(B)」→「caMonの発行 (H)」より, 適切なプロファイルを選択し, 「発行(U)」を押下することで, 他の環境でも動作するexeファイルを生成できます.

プロファイルと設定内容の対応は, 次の通りです.
|プロファイル名|TargetPlatform(TargetRuntime)|SingleFile|Ready To Run|
|-|-|
|RuntimeNotIncludedPack|ランタイム依存|X|X|
|Win_arm|Windows on Arm CPU|O|O|
|Win_x64|Windows on x64 CPU|O|O|
|Win_x86|Windows on x86 CPU|O|O|

なお, いずれもTargetFrameworkはnetcoreapp3.1 (.Net Core 3.1)です.

## 開発方針について
特に開発方針を定めている訳ではないですが, 概ね次のようなイメージで開発を行っています.  イメージというか, なんか希望も混じってますが…まぁそこは気にせず.

- caMon.exe
  - Windowの管理や操作を行う
  - BIDS Shared Memory Libaryの初期化操作等を行う  
  - Pageは含めない
    - ウィンドウ表示中の設定変更は, やるとしたらセレクタからできる仕組みを用意する
    - ライセンス表示は各modが独自に行う.  その場合, 本体のライセンス情報をmodに提供する手段が必要になる.
    - 例外発生時はConsoleへの出力か, あるいはMessageBoxへの出力で通知する
  - デフォルトのセレクタを除き, modへの静的参照は行わない
  - セレクタは起動中不変であり, 従ってreadonlyなフィールドにインスタンスを配置する
  - コマンドライン引数の次点の優先順位程度に, 設定ファイルによるオプションのプリセットを行いたい
- caMon.IPages.dll
  - セレクタを含む, caMonを使用したいすべての画面表示modが備える必要があるインターフェイスを定義する
  - 各modが本体側を操作するための機能など, 本体に関わる機能を実装する
- caMon.ISelector.dll
  - セレクタが備える必要があるインターフェイスを定義する
  - 特にセレクタに便利と考えられる機能を実装する
  - 本体に関わる機能のうち, セレクタぐらいしか使用しないと考えられるものはこちらに実装する  
    但し, よほどの自信がない限り, 基本的にはcaMon.IPages.dllの方に実装するべき

- caMon.pages.e233sp.dll / caMon.pages.e235sp.dll
  - 基本的にバグ修正や本体の更新追従のみを行う(但し, 機能追加のPullRequestは受け付けるので, お気軽にどうぞ)
- caMon.pages.sample.dll
  - あくまでサンプルであり, 極力シンプルな構造にする  
    デザインも大事だが, デザインに重視しすぎて複雑な構造にするのはダメ
  - コメントは初心者向けに(とは言いつつ初期状態でのコメントが少ないけど)
  - 極力すべてのデータ/機能を網羅する
- caMon.selector.default
  - 基本的にバグ修正や本体の更新追従のみを行う(但し, 機能追加のPullRequestは受け付けるので, お気軽にどうぞ)
